postgres=# --https://data.cityofnewyork.us/Health/Metal-Content-of-Consumer-Products-Tested-by-the-N/da9u-wz3r
postgres=# \copy product from 'c:/Users/joe/Downloads/foo.csv' csv HEADER
COPY 1635
postgres=# \d
          List of relations
 Schema |  Name   | Type  |  Owner
--------+---------+-------+----------
 public | product | table | postgres
(1 row)


postgres=# \d product
                         Table "public.product"
    Column     |          Type          | Collation | Nullable | Default
---------------+------------------------+-----------+----------+---------
 row_id        | integer                |           | not null |
 type          | text                   |           |          |
 name          | text                   |           |          |
 metal         | text                   |           |          |
 concentration | real                   |           |          |
 units         | character varying(255) |           |          |
 manufacturer  | text                   |           |          |
 country       | text                   |           |          |
 date          | character varying(255) |           |          |
 deleted       | boolean                |           |          |
Indexes:
    "product_pkey" PRIMARY KEY, btree (row_id)


postgres=# select * from product limit 10;
 row_id |                 type                  |                    name
              |  metal  | concentration | units |                manufacturer
              |        country        |          date          | deleted
--------+---------------------------------------+--------------------------------------------+---------+---------------+-------+--------------------------------------------+-----------------------+------------------------+---------
    766 | Food-Spice                            | Dry Mango Powder
              | Lead    |            -1 | ppm   | UNKNOWN OR NOT STATED
              | INDIA                 | 03/29/2013 12:00:00 AM | f
   1360 | Dietary Supplement/Medications/Remedy | Marichyadi Bati (Ayurvedic)
              | Mercury |            37 | ppm   | Shree Baidyanath; Ayurved Bhawan Pvt. Ltd. | INDIA                 | 02/25/2015 12:00:00 AM | f
    458 | Food-Candy                            | Candy
              | Lead    |            -1 | ppm   | UNKNOWN OR NOT STATED
              | UNKNOWN OR NOT STATED | 05/14/2012 12:00:00 AM | f
    761 | Dietary Supplement/Medications/Remedy | Piperine 4 (Homeopathic)
              | Arsenic |            -1 | ppm   | UNKNOWN OR NOT STATED
              | INDIA                 | 03/29/2013 12:00:00 AM | f
   1025 | Toys/Children's Products              | Red toy car
              | Lead    |            -1 | ppm   | Mattel
              | THAILAND              | 01/09/2014 12:00:00 AM | f
    870 | Toys/Children's Products              | Toy car
              | Lead    |            -1 | ppm   | UNKNOWN OR NOT STATED
              | CHINA                 | 07/24/2013 12:00:00 AM | f
    812 | Dietary Supplement/Medications/Remedy | Balance & Comfort II (Yan Hu Suo Capsules) | Lead    |            -1 | ppm   | UNKNOWN OR NOT STATED
              | CHINA                 | 06/12/2013 12:00:00 AM | f
    361 | Dietary Supplement/Medications/Remedy | Phal (Ayurvedic)
              | Arsenic |            -1 | ppm   | Shree Aushadh Pratisthan
              | INDIA                 | 01/23/2012 12:00:00 AM | f
    242 | Toys/Children's Products              | Wooden block
              | Lead    |           4.6 | ppm   | Melissa & Doug
              | CHINA                 | 07/14/2011 12:00:00 AM | f
     27 | Jewelry                               | Fashion hair clip
              | Lead    |        330000 | ppm   | UNKNOWN OR NOT STATED
              | UNKNOWN OR NOT STATED | 02/08/2011 12:00:00 AM | f
(10 rows)


postgres=# select distinct units from product;
  units
---------
 MG/CM^2
 ppm
(2 rows)


                                   ^
postgres=# select distinct country from product;
                 country
-----------------------------------------
 YEMEN
 EGYPT
 ECUADOR
 SAUDI ARABIA
 ITALY
 MELNESIA
 PERU
 CROATIA (local name: Hrvatska)
 ALGERIA
 OTHER EUROPEAN
 JAPAN
 IVORY COAST
 UZBEKISTAN
 HAITI
 GUYANA
 IRAQ
 BANGLADESH
 SPAIN
 SWITZERLAND
 ERITREA
 ISRAEL
 GUINEA
 NIGERIA
 HONG KONG
 PHILIPPINES
 MALAYSIA
 JAMAICA
 TAIWAN - PROVINCE OF CHINA
 BRAZIL
 KOREA - DEMOCRATIC PEOPLE'S REPUBLIC OF
 TUNISIA
 TOGO
 UNKNOWN OR NOT STATED
 CHILE
 THAILAND
 INDONESIA
 RUSSIAN FEDERATION
 PARAGUAY
 IRAN (ISLAMIC REPUBLIC OF)
 FRANCE
 JORDAN
 MOROCCO
 DOMINICAN REPUBLIC
 AFGHANISTAN
 LIBERIA
 TANZANIA - UNITED REPUBLIC OF
 MALI
 UNITED STATES
 GHANA
 TURKEY
 MEXICO
 CHINA
 PAKISTAN
 HUNGARY
 GEORGIA
 MACAU
 GERMANY
 COTE D'IVOIRE
 COLOMBIA
 INDIA
 TRINIDAD AND TOBAGO
 UNITED KINGDOM
 LEBANON
 SWEDEN
 VIET NAM
 UNITED ARAB EMIRATES
 SENEGAL
(67 rows)




postgres=# select country, count(row_id) from product group by country;
                 country                 | count
-----------------------------------------+-------
 YEMEN                                   |     2
 EGYPT                                   |     4
 ECUADOR                                 |    12
 SAUDI ARABIA                            |     3
 ITALY                                   |     2
 MELNESIA                                |     1
 PERU                                    |     2
 CROATIA (local name: Hrvatska)          |     1
 ALGERIA                                 |     2
 OTHER EUROPEAN                          |     1
 JAPAN                                   |     6
 IVORY COAST                             |     1
 UZBEKISTAN                              |     2
 HAITI                                   |     1
 GUYANA                                  |     3
 IRAQ                                    |     1
 BANGLADESH                              |   131
 SPAIN                                   |     4
 SWITZERLAND                             |     1
 ERITREA                                 |     2
 ISRAEL                                  |     1
 GUINEA                                  |     1
 NIGERIA                                 |     4
 HONG KONG                               |     6
 PHILIPPINES                             |     3
 MALAYSIA                                |     3
 JAMAICA                                 |    18
 TAIWAN - PROVINCE OF CHINA              |     3
 BRAZIL                                  |     6
 KOREA - DEMOCRATIC PEOPLE'S REPUBLIC OF |     1
 TUNISIA                                 |     2
 TOGO                                    |     1
 UNKNOWN OR NOT STATED                   |   361
 CHILE                                   |     2
 THAILAND                                |    16
 INDONESIA                               |     1
 RUSSIAN FEDERATION                      |     2
 PARAGUAY                                |     1
 IRAN (ISLAMIC REPUBLIC OF)              |     2
 FRANCE                                  |     6
 JORDAN                                  |     3
 MOROCCO                                 |    22
 DOMINICAN REPUBLIC                      |    19
 AFGHANISTAN                             |     2
 LIBERIA                                 |     1
 TANZANIA - UNITED REPUBLIC OF           |     1
 MALI                                    |     9
 UNITED STATES                           |    53
 GHANA                                   |     6
 TURKEY                                  |     2
 MEXICO                                  |    90
 CHINA                                   |   162
 PAKISTAN                                |    77
 HUNGARY                                 |     1
 GEORGIA                                 |    88
 MACAU                                   |     1
 GERMANY                                 |     5
 COTE D'IVOIRE                           |     9
 COLOMBIA                                |     3
 INDIA                                   |   418
 TRINIDAD AND TOBAGO                     |     2
 UNITED KINGDOM                          |     9
 LEBANON                                 |    22
 SWEDEN                                  |     1
 VIET NAM                                |     1
 UNITED ARAB EMIRATES                    |     1
 SENEGAL                                 |     5
(67 rows)


postgres=# select country, count(row_id) as c from product group by country order by c;
                 country                 |  c
-----------------------------------------+-----
 ISRAEL                                  |   1
 GUINEA                                  |   1
 HUNGARY                                 |   1
 PARAGUAY                                |   1
 UNITED ARAB EMIRATES                    |   1
 OTHER EUROPEAN                          |   1
 TANZANIA - UNITED REPUBLIC OF           |   1
 SWEDEN                                  |   1
 LIBERIA                                 |   1
 KOREA - DEMOCRATIC PEOPLE'S REPUBLIC OF |   1
 IVORY COAST                             |   1
 TOGO                                    |   1
 MELNESIA                                |   1
 HAITI                                   |   1
 VIET NAM                                |   1
 IRAQ                                    |   1
 INDONESIA                               |   1
 MACAU                                   |   1
 SWITZERLAND                             |   1
 CROATIA (local name: Hrvatska)          |   1
 AFGHANISTAN                             |   2
 IRAN (ISLAMIC REPUBLIC OF)              |   2
 RUSSIAN FEDERATION                      |   2
 PERU                                    |   2
 ALGERIA                                 |   2
 UZBEKISTAN                              |   2
 TRINIDAD AND TOBAGO                     |   2
 ERITREA                                 |   2
 TURKEY                                  |   2
 YEMEN                                   |   2
 ITALY                                   |   2
 TUNISIA                                 |   2
 CHILE                                   |   2
 MALAYSIA                                |   3
 SAUDI ARABIA                            |   3
 GUYANA                                  |   3
 PHILIPPINES                             |   3
 TAIWAN - PROVINCE OF CHINA              |   3
 JORDAN                                  |   3
 COLOMBIA                                |   3
 EGYPT                                   |   4
 NIGERIA                                 |   4
 SPAIN                                   |   4
 GERMANY                                 |   5
 SENEGAL                                 |   5
 FRANCE                                  |   6
 BRAZIL                                  |   6
 GHANA                                   |   6
 HONG KONG                               |   6
 JAPAN                                   |   6
 UNITED KINGDOM                          |   9
 MALI                                    |   9
 COTE D'IVOIRE                           |   9
 ECUADOR                                 |  12
 THAILAND                                |  16
 JAMAICA                                 |  18
 DOMINICAN REPUBLIC                      |  19
 LEBANON                                 |  22

postgres=# select country, count(row_id) as c from product group by country order by c desc;
                 country                 |  c
-----------------------------------------+-----
 INDIA                                   | 418
 UNKNOWN OR NOT STATED                   | 361
 CHINA                                   | 162
 BANGLADESH                              | 131
 MEXICO                                  |  90
 GEORGIA                                 |  88
 PAKISTAN                                |  77
 UNITED STATES                           |  53
 LEBANON                                 |  22
 MOROCCO                                 |  22
 DOMINICAN REPUBLIC                      |  19
 JAMAICA                                 |  18
 THAILAND                                |  16
 ECUADOR                                 |  12
 MALI                                    |   9
 COTE D'IVOIRE                           |   9
 UNITED KINGDOM                          |   9
 JAPAN                                   |   6
 GHANA                                   |   6
 FRANCE                                  |   6
 HONG KONG                               |   6
 BRAZIL                                  |   6
 SENEGAL                                 |   5
 GERMANY                                 |   5
 NIGERIA                                 |   4
 SPAIN                                   |   4
 EGYPT                                   |   4
 MALAYSIA                                |   3
 SAUDI ARABIA                            |   3
 GUYANA                                  |   3
 PHILIPPINES                             |   3
 TAIWAN - PROVINCE OF CHINA              |   3
 JORDAN                                  |   3
 COLOMBIA                                |   3
 TUNISIA                                 |   2
 RUSSIAN FEDERATION                      |   2
 IRAN (ISLAMIC REPUBLIC OF)              |   2
 YEMEN                                   |   2
 AFGHANISTAN                             |   2
 ERITREA                                 |   2
 TURKEY                                  |   2
 UZBEKISTAN                              |   2
 ALGERIA                                 |   2
 ITALY                                   |   2
 TRINIDAD AND TOBAGO                     |   2
 PERU                                    |   2
 CHILE                                   |   2
 CROATIA (local name: Hrvatska)          |   1
 SWITZERLAND                             |   1
 VIET NAM                                |   1
 IRAQ                                    |   1
 HAITI                                   |   1
 TOGO                                    |   1
 HUNGARY                                 |   1
 IVORY COAST                             |   1
 INDONESIA                               |   1
 MACAU                                   |   1
 PARAGUAY                                |   1


postgres=# -- note that only columns that appear in group by or aggregates can appear in list. 
postgres=# -- from the docs:
postgres=# -- "When GROUP BY is present, or any aggregate functions are present, it is not valid for the 
postgres=# -- SELECT list expressions to refer to ungrouped columns except within aggregate functions or 
postgres=# -- when the ungrouped column is functionally dependent on the grouped columns, since there 
postgres=# -- would otherwise be more than one possible value to return for an ungrouped column. A postgres=# -- functional dependency exists if the grouped columns (or a subset thereof) are the primary postgres=# -- key of the table containing the ungrouped column.
postgres=# -- see error below:

postgres=# select country, type, name, max(concentration) as c from product group by country order by c desc;
ERROR:  column "product.type" must appear in the GROUP BY clause or be used in an aggregate function
LINE 1: select country, type, name, max(concentration) as c from pro...
                        ^
postgres=# -- now with only grouped by column and aggregate function
postgres=# select country, max(concentration) as c from product group by country order by c desc;
                 country                 |   c
-----------------------------------------+--------
 UNKNOWN OR NOT STATED                   | 1e+006
 PAKISTAN                                | 930000
 AFGHANISTAN                             | 730000
 BANGLADESH                              | 580000
 INDIA                                   | 570000
 SAUDI ARABIA                            | 540000
 MOROCCO                                 | 450000
 MEXICO                                  | 320000
 ECUADOR                                 |  63000
 GEORGIA                                 |  27000
 CHINA                                   |   1300
 MALI                                    |    240
 ERITREA                                 |    220
 UNITED STATES                           |     70
 KOREA - DEMOCRATIC PEOPLE'S REPUBLIC OF |     69
 UNITED KINGDOM                          |     48
 VIET NAM                                |     47
 MACAU                                   |     41
 THAILAND                                |     32
 DOMINICAN REPUBLIC                      |     16
 HONG KONG                               |     16
 BRAZIL                                  |     16
 LIBERIA                                 |     14
 LEBANON                                 |     12
 SWITZERLAND                             |    5.1
 COTE D'IVOIRE                           |    2.7
 GERMANY                                 |    2.7
 UNITED ARAB EMIRATES                    |      2
 PARAGUAY                                |    1.8
 CHILE                                   |    1.7
 JAPAN                                   |    1.6
 IRAN (ISLAMIC REPUBLIC OF)              |    1.5
 IRAQ                                    |    1.4
 TRINIDAD AND TOBAGO                     |    1.3

postgres=# -- a similar error occurs in having clause (must be in group by or aggregate func). see error:
postgres=# select country, max(concentration) as c from product group by country having concentration = -1 order by c desc;
ERROR:  column "product.concentration" must appear in the GROUP BY clause or be used in an aggregate function
LINE 1: ...ration) as c from product group by country having concentrat...

postgres=# -- corrected version by putting in aggregate function
postgres=# select country, max(concentration) as c from product group by country having max(concentration)=-1 order by c desc;
            country             | c
--------------------------------+----
 YEMEN                          | -1
 ITALY                          | -1
 MELNESIA                       | -1
 PERU                           | -1
 CROATIA (local name: Hrvatska) | -1
 OTHER EUROPEAN                 | -1
 IVORY COAST                    | -1
 HAITI                          | -1
 SPAIN                          | -1
 ISRAEL                         | -1
 GUINEA                         | -1
 NIGERIA                        | -1
 PHILIPPINES                    | -1
 MALAYSIA                       | -1
 TAIWAN - PROVINCE OF CHINA     | -1
 TUNISIA                        | -1
 INDONESIA                      | -1
 RUSSIAN FEDERATION             | -1
 GHANA                          | -1
 TURKEY                         | -1
 HUNGARY                        | -1
 COLOMBIA                       | -1
 SWEDEN                         | -1
 SENEGAL                        | -1
(24 rows)


postgres=# --to finish up, let's see the products with the most metal
postgres=# select name, metal, type, concentration from product order by concentration desc;
                           name                            |  metal  |
        type                  | concentration
-----------------------------------------------------------+---------+---------------------------------------+---------------
 Amulet-metal clasps                                       | Lead    | Jewelry
                              |        1e+006
 Metal rods in fish                                        | Lead    | Other
                              |        950000
 Surma (Hashmi)                                            | Lead    | Cosmetics                             |        930000
 Surma (Hashmi)                                            | Lead    | Cosmetics                             |        930000
 Metal charms -butterfly                                   | Lead    | Jewelry
                              |        870000
 Surma                                                     | Lead    | QA/QC - Lab test                      |        830000
 Jewelry                                                   | Lead    | Jewelry
                              |        830000
 Surma                                                     | Lead    | Cosmetics                             |        790000
 Surma                                                     | Lead    | Cosmetics                             |        770000
 Surma                                                     | Lead    | Cosmetics                             |        770000
 Surma (Hashmi)                                            | Lead    | Cosmetics                             |        750000
 Surma                                                     | Lead    | Cosmetics                             |        730000
 Surma                                                     | Lead    | Cosmetics                             |        720000
 Surma                                                     | Lead    | Cosmetics                             |        710000
 Surma                                                     | Lead    | Cosmetics                             |        700000
 Surma                                                     | Lead    | Cosmetics                             |        630000
 Surma Special                                             | Lead    | Cosmetics                             |        620000
 Surma (Hashmi)                                            | Lead    | Cosmetics                             |        610000
 Surma (Hashmi)                                            | Lead    | Cosmetics                             |        610000
 Surma (Hashmi)                                            | Lead    | Cosmetics                             |        600000
 Amulet (Tabeez)                                           | Lead    | Jewelry
                              |        580000
 Sindoor                                                   | Lead    | Religious powder                      |        570000
 Surma                                                     | Lead    | Cosmetics                             |        540000
 Metal painted charms - bear shaped                        | Lead    | Jewelry
                              |        530000
 Surma                                                     | Lead    | Cosmetics                             |        530000
 Surma                                                     | Lead    | Cosmetics                             |        520000
 Kohl                                                      | Lead    | Cosmetics                             |        500000
 Amulet/charm                                              | Lead    | Jewelry
                              |        500000
^Cpostgres=# select country, max(concentration) as c from product group by country having concentration=-1 order by c desc;
ERROR:  column "product.concentration" must appear in the GROUP BY clause or be used in an aggregate function
LINE 1: ...ration) as c from product group by country having concentrat...
                                                             ^
postgres=# select country, max(concentration) as c from product group by country having c=-1 order by c desc;
ERROR:  column "c" does not exist
LINE 1: ...ration) as c from product group by country having c=-1 order...
                                                             ^
postgres=#                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          `